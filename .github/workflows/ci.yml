name: CI

on:
  pull_request:
  push:
    branches: [main]

jobs:
  buck:
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v3
        with:
          submodules: true

      - name: Download buckle
        run: |
          curl -OL https://github.com/benbrittain/buckle/releases/download/v1.1.0/buckle-x86_64-unknown-linux-gnu.tar.xz
          tar -Jxvf buckle-x86_64-unknown-linux-gnu.tar.xz

      - uses: TraceMachina/nativelink-action@19474c93528dc1a7f25ea02e17f6ab3b0880d970
        with:
          api_key: ${{ secrets.NATIVELINK_API_KEY }}
          account: tom-parker-shemilt
          prefix: tom-parker-shemilt-y0738m
          build_system: buck2

      - run: buckle-x86_64-unknown-linux-gnu/buckle build //...
